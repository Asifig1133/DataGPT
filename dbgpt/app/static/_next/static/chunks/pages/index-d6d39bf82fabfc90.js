(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(57464)}])},81799:function(e,t,n){"use strict";n.d(t,{A:function(){return d}});var a=n(85893),s=n(41468),l=n(51009),c=n(19284),r=n(25675),o=n.n(r),i=n(67294),u=n(67421);function d(e,t){var n;let{width:s,height:l}=t||{};return e?(0,a.jsx)(o(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:s||24,height:l||24,src:(null===(n=c.Hf[e])||void 0===n?void 0:n.icon)||"/models/huggingface.svg",alt:"llm"}):null}t.Z=function(e){let{onChange:t}=e,{t:n}=(0,u.$G)(),{modelList:r,model:o}=(0,i.useContext)(s.p);return!r||r.length<=0?null:(0,a.jsx)(l.default,{value:o,placeholder:n("choose_model"),className:"w-52",onChange:e=>{null==t||t(e)},children:r.map(e=>{var t;return(0,a.jsx)(l.default.Option,{children:(0,a.jsxs)("div",{className:"flex items-center",children:[d(e),(0,a.jsx)("span",{className:"ml-2",children:(null===(t=c.Hf[e])||void 0===t?void 0:t.label)||e})]})},e)})})}},20766:function(e,t,n){"use strict";n.d(t,{Z:function(){return z}});var a=n(85893),s=n(27496),l=n(59566),c=n(71577),r=n(67294),o=n(2487),i=n(83062),u=n(2453),d=n(46735),m=n(74627),h=n(39479),p=n(51009),x=n(58299),f=n(577),v=n(30119),w=n(67421);let g=e=>{let{data:t,loading:n,submit:s,close:l}=e,{t:c}=(0,w.$G)(),r=e=>()=>{s(e),l()};return(0,a.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,a.jsx)(o.Z,{dataSource:null==t?void 0:t.data,loading:n,rowKey:e=>e.prompt_name,renderItem:e=>(0,a.jsx)(o.Z.Item,{onClick:r(e.content),children:(0,a.jsx)(i.Z,{title:e.content,children:(0,a.jsx)(o.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:c("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+c("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};var _=e=>{let{submit:t}=e,{t:n}=(0,w.$G)(),[s,l]=(0,r.useState)(!1),[c,o]=(0,r.useState)("common"),{data:_,loading:j}=(0,f.Z)(()=>(0,v.PR)("/prompt/list",{prompt_type:c}),{refreshDeps:[c],onError:e=>{u.ZP.error(null==e?void 0:e.message)}});return(0,a.jsx)(d.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,a.jsx)(m.Z,{title:(0,a.jsx)(h.Z.Item,{label:"Prompt "+n("Type"),children:(0,a.jsx)(p.default,{style:{width:150},value:c,onChange:e=>{o(e)},options:[{label:n("Public")+" Prompts",value:"common"},{label:n("Private")+" Prompts",value:"private"}]})}),content:(0,a.jsx)(g,{data:_,loading:j,submit:t,close:()=>{l(!1)}}),placement:"topRight",trigger:"click",open:s,onOpenChange:e=>{l(e)},children:(0,a.jsx)(i.Z,{title:n("Click_Select")+" Prompt",children:(0,a.jsx)(x.Z,{className:"bottom-[30%]"})})})})},j=n(41468),b=n(50489),N=n(80573),y=n(5392),Z=n(84553);function k(e){let{dbParam:t,setDocId:n}=(0,r.useContext)(j.p),{onUploadFinish:s,handleFinish:l}=e,o=(0,N.Z)(),[i,u]=(0,r.useState)(!1),d=async(e,t)=>{await (0,b.Vx)((0,b.Hx)(e,{doc_ids:[t]}))},m=async e=>{u(!0);let a=new FormData;a.append("doc_name",e.file.name),a.append("doc_file",e.file),a.append("doc_type","DOCUMENT");let c=await (0,b.Vx)((0,b.iG)(t||"default",a));if(!c[1]){u(!1);return}n(c[1]),s(),await d(t||"default",null==c?void 0:c[1]),u(!1),null==l||l(!0),await o(c[1]),null==l||l(!1)};return(0,a.jsx)(Z.default,{customRequest:m,showUploadList:!1,maxCount:1,multiple:!1,className:"absolute z-10 top-2 left-2",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:(0,a.jsx)(c.ZP,{loading:i,size:"small",shape:"circle",icon:(0,a.jsx)(y.Z,{})})})}var C=n(11163),P=n(82579);function S(){return(0,a.jsx)("svg",{className:"mr-1",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6058",width:"1.5em",height:"1.5em",children:(0,a.jsx)("path",{d:"M688 312c0 4.4-3.6 8-8 8H296c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h384c4.4 0 8 3.6 8 8v48z m-392 88h184c4.4 0 8 3.6 8 8v48c0 4.4-3.6 8-8 8H296c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8z m376 116c119.3 0 216 96.7 216 216s-96.7 216-216 216-216-96.7-216-216 96.7-216 216-216z m107.5 323.5C808.2 810.8 824 772.6 824 732s-15.8-78.8-44.5-107.5S712.6 580 672 580s-78.8 15.8-107.5 44.5S520 691.4 520 732s15.8 78.8 44.5 107.5S631.4 884 672 884s78.8-15.8 107.5-44.5zM440 852c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H168c-17.7 0-32-14.3-32-32V108c0-17.7 14.3-32 32-32h640c17.7 0 32 14.3 32 32v384c0 4.4-3.6 8-8 8h-56c-4.4 0-8-3.6-8-8V148H208v704h232z m232-76.06l-20.56 28.43c-1.5 2.1-3.9 3.3-6.5 3.3h-44.3c-6.5 0-10.3-7.4-6.4-12.7l45.75-63.3-45.75-63.3c-3.9-5.3-0.1-12.7 6.4-12.7h44.3c2.6 0 5 1.2 6.5 3.3L672 687.4l20.56-28.43c1.5-2.1 3.9-3.3 6.5-3.3h44.3c6.5 0 10.3 7.4 6.4 12.7l-45.75 63.3 45.75 63.3c3.9 5.3 0.1 12.7-6.4 12.7h-44.3c-2.6 0-5-1.2-6.5-3.3L672 775.94z",fill:"#d81e06","p-id":"6059"})})}function R(e){let{document:t}=e;switch(t.status){case"RUNNING":return(0,a.jsx)(P.Rp,{});case"FINISHED":default:return(0,a.jsx)(P.s2,{});case"FAILED":return(0,a.jsx)(S,{})}}function E(e){let{documents:t,dbParam:n}=e,s=(0,C.useRouter)(),l=e=>{s.push("/knowledge/chunk/?spaceName=".concat(n,"&id=").concat(e))};return(null==t?void 0:t.length)?(0,a.jsx)("div",{className:"absolute flex overflow-scroll h-12 top-[-35px] w-full z-10",children:t.map(e=>{let t;switch(e.status){case"RUNNING":t="#2db7f5";break;case"FINISHED":default:t="#87d068";break;case"FAILED":t="#f50"}return(0,a.jsx)(i.Z,{title:e.result,children:(0,a.jsxs)(c.ZP,{style:{color:t},onClick:()=>{l(e.id)},className:"shrink flex items-center mr-3",children:[(0,a.jsx)(R,{document:e}),e.doc_name]})},e.id)})}):null}var z=function(e){let{children:t,loading:n,onSubmit:o,handleFinish:i,...u}=e,{dbParam:d,scene:m}=(0,r.useContext)(j.p),[h,p]=(0,r.useState)(""),x=(0,r.useMemo)(()=>"chat_knowledge"===m,[m]),[f,v]=(0,r.useState)([]),w=(0,r.useRef)(0);async function g(){if(!d)return null;let[e,t]=await (0,b.Vx)((0,b._Q)(d,{page:1,page_size:w.current}));v(null==t?void 0:t.data)}return(0,r.useEffect)(()=>{x&&g()},[d]),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(E,{documents:f,dbParam:d}),x&&(0,a.jsx)(k,{handleFinish:i,onUploadFinish:()=>{w.current+=1,g()},className:"absolute z-10 top-2 left-2"}),(0,a.jsx)(l.default.TextArea,{className:"flex-1 ".concat(x?"pl-10":""," pr-10"),size:"large",value:h,autoSize:{minRows:1,maxRows:4},...u,onPressEnter:e=>{if(h.trim()&&13===e.keyCode){if(e.shiftKey){p(e=>e+"\n");return}o(h),setTimeout(()=>{p("")},0)}},onChange:e=>{if("number"==typeof u.maxLength){p(e.target.value.substring(0,u.maxLength));return}p(e.target.value)}}),(0,a.jsx)(c.ZP,{className:"ml-2 flex items-center justify-center absolute right-2 bottom-0",size:"large",type:"text",loading:n,icon:(0,a.jsx)(s.Z,{}),onClick:()=>{o(h)}}),(0,a.jsx)(_,{submit:e=>{p(h+e)}}),t]})}},43446:function(e,t,n){"use strict";var a=n(1375),s=n(2453),l=n(67294),c=n(58989);t.Z=e=>{let{queryAgentURL:t="/api/v1/chat/completions"}=e,n=(0,l.useMemo)(()=>new AbortController,[]),r=(0,l.useCallback)(async e=>{let{data:l,chatId:r,onMessage:o,onClose:i,onDone:u,onError:d}=e;if(!(null==l?void 0:l.user_input)&&!(null==l?void 0:l.doc_id)){s.ZP.warning(c.Z.t("NoContextTip"));return}let m={...l,conv_uid:r};if(!m.conv_uid){s.ZP.error("conv_uid 不存在，请刷新后重试");return}try{var h;await (0,a.L)("".concat((h="http://localhost:5000",void 0!==h)?h:"").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m),signal:n.signal,openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===a.a)return},onclose(){n.abort(),null==i||i()},onerror(e){throw Error(e)},onmessage:e=>{var t;let n=null===(t=e.data)||void 0===t?void 0:t.replaceAll("\\n","\n");"[DONE]"===n?null==u||u():(null==n?void 0:n.startsWith("[ERROR]"))?null==d||d(null==n?void 0:n.replace("[ERROR]","")):null==o||o(n)}})}catch(e){n.abort(),null==d||d("Sorry, We meet some error, please try agin later.",e)}},[t]);return(0,l.useEffect)(()=>()=>{n.abort()},[]),r}},80573:function(e,t,n){"use strict";var a=n(41468),s=n(67294),l=n(43446),c=n(50489);t.Z=()=>{let{history:e,setHistory:t,chatId:n,model:r,docId:o}=(0,s.useContext)(a.p),i=(0,l.Z)({queryAgentURL:"/knowledge/document/summary"}),u=(0,s.useCallback)(async e=>{let[,a]=await (0,c.Vx)((0,c.$i)(n)),s=[...a,{role:"human",context:"",model_name:r,order:0,time_stamp:0},{role:"view",context:"",model_name:r,order:0,time_stamp:0,retry:!0}],l=s.length-1;t([...s]),await i({data:{doc_id:e||o,model_name:r},chatId:n,onMessage:e=>{s[l].context=e,t([...s])}})},[e,r,o,n]);return u}},57464:function(e,t,n){"use strict";n.r(t);var a=n(85893),s=n(577),l=n(67294),c=n(96074),r=n(75081),o=n(66309),i=n(39332),u=n(25675),d=n.n(u),m=n(50489),h=n(81799),p=n(41468),x=n(20766),f=n(67421),v=n(98399),w=n(53014),g=n(82579),_=n(94184),j=n.n(_);t.default=()=>{let e=(0,i.useRouter)(),{model:t,setModel:n}=(0,l.useContext)(p.p),{t:u}=(0,f.$G)(),[_,b]=(0,l.useState)(!1),[N,y]=(0,l.useState)(!1),{data:Z=[]}=(0,s.Z)(async()=>{y(!0);let[,e]=await (0,m.Vx)((0,m.CU)());return y(!1),null!=e?e:[]}),k=async n=>{b(!0);let[,a]=await (0,m.Vx)((0,m.sW)({chat_mode:"chat_normal"}));a&&(localStorage.setItem(v.rU,JSON.stringify({id:a.conv_uid,message:n})),e.push("/chat/?scene=chat_normal&id=".concat(a.conv_uid).concat(t?"&model=".concat(t):""))),b(!1)},C=async n=>{if(n.show_disable)return;let[,a]=await (0,m.Vx)((0,m.sW)({chat_mode:"chat_normal"}));a&&e.push("/chat?scene=".concat(n.chat_scene,"&id=").concat(a.conv_uid).concat(t?"&model=".concat(t):""))};return(0,a.jsx)("div",{className:"px-4 h-screen flex flex-col justify-center items-center overflow-hidden",children:(0,a.jsxs)("div",{className:"max-w-3xl max-h-screen overflow-y-auto flex flex-col items-center",children:[(0,a.jsx)(d(),{src:"/LOGO.png",alt:"gpt",width:10,height:10,style:{width:"60px",height:"60px"},className:"w-1/4 mt-4",unoptimized:!0}),(0,a.jsx)(c.Z,{className:"!text-[#878c93] !my-6",plain:!0,children:u("Quick_Start")}),(0,a.jsx)(r.Z,{spinning:N,children:(0,a.jsx)("div",{className:"flex flex-wrap -m-1 md:-m-2",children:Z.map(e=>(0,a.jsx)("div",{className:"w-full sm:w-1/2 p-1 md:p-2",onClick:()=>{C(e)},children:(0,a.jsxs)("div",{className:j()("flex flex-row justify-center min-h-min border bg-slate-50 border-gray-300 dark:bg-black bg-opacity-50 border-opacity-50 text-gray-950 dark:text-white rounded p-4 cursor-pointer",{"grayscale !cursor-no-drop":e.show_disable}),children:[function(e){switch(e){case"chat_knowledge":return(0,a.jsx)(w.Z,{className:"w-10 h-10 mr-4 p-1 bg-white rounded",component:g.je});case"chat_with_db_execute":return(0,a.jsx)(w.Z,{className:"w-10 h-10 mr-4 p-1 bg-white rounded",component:g.zM});case"chat_excel":return(0,a.jsx)(w.Z,{className:"w-10 h-10 mr-4 p-1 bg-white rounded",component:g.DL});case"chat_with_db_qa":return(0,a.jsx)(w.Z,{className:"w-10 h-10 mr-4 p-1 bg-white rounded",component:g.RD});case"chat_dashboard":return(0,a.jsx)(w.Z,{className:"w-10 h-10 mr-4 p-1 bg-white rounded",component:g.In});case"chat_agent":return(0,a.jsx)(w.Z,{className:"w-10 h-10 mr-4 p-1 bg-white rounded",component:g.si});default:return null}}(e.chat_scene),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsxs)("h2",{className:"flex items-center text-lg font-sans font-semibold",children:[e.scene_name,e.show_disable&&(0,a.jsx)(o.Z,{className:"ml-2",children:"Comming soon"})]}),(0,a.jsx)("p",{className:"opacity-80 line-clamp-2",children:e.scene_describe})]})]})},e.chat_scene))})}),(0,a.jsx)("div",{className:"mt-8 mb-2",children:(0,a.jsx)(h.Z,{onChange:e=>{n(e)}})}),(0,a.jsx)("div",{className:"flex flex-1 w-full mb-4",children:(0,a.jsx)(x.Z,{loading:_,onSubmit:k})})]})})}},30119:function(e,t,n){"use strict";n.d(t,{Tk:function(){return r},PR:function(){return o}});var a=n(2453),s=n(6154);let l=s.Z.create({baseURL:"http://localhost:5000"});l.defaults.timeout=1e4,l.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),n(96486);let c={"content-type":"application/json"},r=(e,t)=>{if(t){let n=Object.keys(t).filter(e=>void 0!==t[e]&&""!==t[e]).map(e=>"".concat(e,"=").concat(t[e])).join("&");n&&(e+="?".concat(n))}return l.get("/api"+e,{headers:c}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})},o=(e,t)=>l.post(e,t,{headers:c}).then(e=>e).catch(e=>{a.ZP.error(e),Promise.reject(e)})}},function(e){e.O(0,[662,64,479,9,553,924,411,270,412,981,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);